<% content_for :title, "Posts" %>

<div class="page">
  <header class="page__header">
    <h1>Rap Blog</h1>
    <%= link_to "New post", new_post_path, class: "button" %>
  </header>

  <% if @posts.any? %>
    <div class="post-list">
      <% @posts.each do |post| %>
        <article class="post-card" data-post-url="<%= post_path(post) %>" tabindex="0" role="link">
          <% if post.images.attached? %>
            <div class="post-card__image">
              <%= image_tag post.images.first, class: "post-card__image-tag" %>
            </div>
          <% end %>
          <h2><%= link_to post.title, post %></h2>
          <p class="post-card__meta">
            <%= link_to post.user.email,
              posts_path(user_id: post.user_id, q: @query, tag: @tag, sort: @sort, from: params[:from], to: params[:to]),
              class: "post-card__meta-link" %>
            Â·
            <% post_date = post.created_at.to_date %>
            <%= link_to post_date.strftime("%d.%m.%Y"),
              posts_path(user_id: @user_id, q: @query, tag: @tag, sort: @sort, from: post_date, to: post_date),
              class: "post-card__meta-link post-card__meta-date" %>
          </p>
          <p><%= truncate(post.body, length: 200) %></p>
          <% if post.tags.any? %>
            <div class="tag-list">
              <% post.tags.each do |tag| %>
                <%= link_to "##{tag.name}", posts_path(tag: tag.name, q: @query, sort: @sort, from: params[:from], to: params[:to], user_id: @user_id), class: "tag#{' tag--active' if @tag == tag.name}" %>
              <% end %>
            </div>
          <% end %>
          <div class="post-card__actions">
            <%= link_to "Read", post, class: "button button--ghost" %>
            <% if logged_in? && (admin? || post.user == current_user) %>
              <%= link_to "Edit", edit_post_path(post), class: "button button--ghost" %>
              <%= link_to "Delete", post, data: { turbo_method: :delete, turbo_confirm: "Delete this post?" }, class: "button button--danger" %>
            <% end %>
          </div>
        </article>
      <% end %>
    </div>
  <% else %>
    <p class="empty">No posts yet. Start the conversation.</p>
  <% end %>
</div>
